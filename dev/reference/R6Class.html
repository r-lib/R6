<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="R6 objects are essentially environments, structured in a way that makes them
look like an object in a more typical object-oriented language than R. They
support public and private members, as well as inheritance across different
packages."><title>Create an R6 reference object generator — R6Class • R6</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an R6 reference object generator — R6Class"><meta property="og:description" content="R6 objects are essentially environments, structured in a way that makes them
look like an object in a more typical object-oriented language than R. They
support public and private members, as well as inheritance across different
packages."><meta property="og:image" content="https://r6.r-lib.org/logo.svg"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="r6.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">R6</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.5.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/Portable.html">Portable and non-portable R6 classes</a>
    <a class="dropdown-item" href="../articles/Debugging.html">Debugging</a>
    <a class="dropdown-item" href="../articles/Performance.html">R6 and Reference Class performance tests</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/R6/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Create an R6 reference object generator</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/R6/blob/HEAD/R/r6_class.R" class="external-link"><code>R/r6_class.R</code></a></small>
      <div class="d-none name"><code>R6Class.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>R6 objects are essentially environments, structured in a way that makes them
look like an object in a more typical object-oriented language than R. They
support public and private members, as well as inheritance across different
packages.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">R6Class</span><span class="op">(</span></span>
<span>  classname <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  active <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inherit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lock_objects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  class <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  portable <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lock_class <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cloneable <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parent_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>classname</dt>
<dd><p>Name of the class. The class name is useful primarily for S3
method dispatch.</p></dd>


<dt>public</dt>
<dd><p>A list of public members, which can be functions (methods) and
non-functions (fields).</p></dd>


<dt>private</dt>
<dd><p>An optional list of private members, which can be functions
and non-functions.</p></dd>


<dt>active</dt>
<dd><p>An optional list of active binding functions.</p></dd>


<dt>inherit</dt>
<dd><p>A R6ClassGenerator object to inherit from; in other words, a
superclass. This is captured as an unevaluated expression which is
evaluated in <code>parent_env</code> each time an object is instantiated.</p></dd>


<dt>lock_objects</dt>
<dd><p>Should the environments of the generated objects be
locked? If locked, new members can't be added to the objects.</p></dd>


<dt>class</dt>
<dd><p>Should a class attribute be added to the object? Default is
<code>TRUE</code>. If <code>FALSE</code>, the objects will simply look like
environments, which is what they are.</p></dd>


<dt>portable</dt>
<dd><p>If <code>TRUE</code> (the default), this class will work with
inheritance across different packages. Note that when this is enabled,
fields and members must be accessed with  <code>self$x</code> or
<code>private$x</code>; they can't be accessed with just <code>x</code>.</p></dd>


<dt>lock_class</dt>
<dd><p>If <code>TRUE</code>, it won't be possible to add more members to
the generator object with <code>$set</code>. If <code>FALSE</code> (the default), then
it will be possible to add more members with <code>$set</code>. The methods
<code>$is_locked</code>, <code>$lock</code>, and <code>$unlock</code> can be used to query
and change the locked state of the class.</p></dd>


<dt>cloneable</dt>
<dd><p>If <code>TRUE</code> (the default), the generated objects will
have method named <code>$clone</code>, which makes a copy of the object.</p></dd>


<dt>parent_env</dt>
<dd><p>An environment to use as the parent of newly-created
objects.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>An R6 object consists of a public environment, and may also contain a private
environment, as well as environments for superclasses. In one sense, the
object and the public environment are the same; a reference to the object is
identical to a reference to the public environment. But in another sense, the
object also consists of the fields, methods, private environment and so on.</p>
<p>The <code>active</code> argument is a list of active binding functions. These
functions take one argument. They look like regular variables, but when
accessed, a function is called with an optional argument. For example, if
<code>obj$x2</code> is an active binding, then when accessed as <code>obj$x2</code>, it
calls the <code>x2()</code> function that was in the <code>active</code> list, with no
arguments. However, if a value is assigned to it, as in <code>obj$x2 &lt;- 50</code>,
then the function is called with the right-side value as its argument, as in
<code>x2(50)</code>. See <code><a href="https://rdrr.io/r/base/bindenv.html" class="external-link">makeActiveBinding</a></code> for more information.</p>
<p>If the public or private lists contain any items that have reference
semantics (for example, an environment), those items will be shared across
all instances of the class. To avoid this, add an entry for that item with a
<code>NULL</code> initial value, and then in the <code>initialize</code> method,
instantiate the object and assign it.</p>
    </div>
    <div class="section level2">
    <h2 id="the-print-method">The <code>print</code> method<a class="anchor" aria-label="anchor" href="#the-print-method"></a></h2>
    


<p>R6 object generators and R6 objects have a default <code>print</code> method to
  show them on the screen: they simply list the members and parameters (e.g.
  lock_objects, portable, etc., see above) of the object.</p>
<p>The default <code>print</code> method of R6 objects can be redefined, by
  supplying a public <code>print</code> method. (<code>print</code> members that are not
  functions are ignored.) This method is automatically called whenever the
  object is printed, e.g. when the object's name is typed at the command
  prompt, or when <code>print(obj)</code> is called. It can also be called directly
  via <code>obj$print()</code>. All extra arguments from a <code>print(obj, ...)</code>
  call are passed on to the <code>obj$print(...)</code> method.</p>
    </div>
    <div class="section level2">
    <h2 id="portable-and-non-portable-classes">Portable and non-portable classes<a class="anchor" aria-label="anchor" href="#portable-and-non-portable-classes"></a></h2>
    


<p>When R6 classes are portable (the default), they can be inherited across
  packages without complication. However, when in portable mode, members must
  be accessed with <code>self</code> and <code>private</code>, as in <code>self$x</code> and
  <code>private$y</code>.</p>
<p>When used in non-portable mode, R6 classes behave more like reference
  classes: inheritance across packages will not work well, and <code>self</code>
  and <code>private</code> are not necessary for accessing fields.</p>
    </div>
    <div class="section level2">
    <h2 id="cloning-objects">Cloning objects<a class="anchor" aria-label="anchor" href="#cloning-objects"></a></h2>
    


<p>R6 objects have a method named <code>clone</code> by default. To disable this,
  use <code>cloneable=FALSE</code>. Having the <code>clone</code> method present will
  slightly increase the memory footprint of R6 objects, but since the method
  will be shared across all R6 objects, the memory use will be negligible.</p>
<p>By default, calling <code>x$clone()</code> on an R6 object will result in a
  shallow clone. That is, if any fields have reference semantics
  (environments, R6, or reference class objects), they will not be copied;
  instead, the clone object will have a field that simply refers to the same
  object.</p>
<p>To make a deep copy, you can use <code>x$clone(deep=TRUE)</code>. With this
  option, any fields that are R6 objects will also be cloned; however,
  environments and reference class objects will not be.</p>
<p>If you want different deep copying behavior, you can supply your own
  private method called <code>deep_clone</code>. This method will be called for
  each field in the object, with two arguments: <code>name</code>, which is the
  name of the field, and <code>value</code>, which is the value. Whatever the
  method returns will be used as the value for the field in the new clone
  object. You can write a <code>deep_clone</code> method that makes copies of
  specific fields, whether they are environments, R6 objects, or reference
  class objects.</p>
    </div>
    <div class="section level2">
    <h2 id="s-details">S3 details<a class="anchor" aria-label="anchor" href="#s-details"></a></h2>
    


<p>Normally the public environment will have two classes: the one supplied in
  the <code>classname</code> argument, and <code>"R6"</code>. It is possible to get the
  public environment with no classes, by using <code>class=FALSE</code>. This will
  result in faster access speeds by avoiding class-based dispatch of
  <code>$</code>. The benefit is negligible in most cases.</p>
<p>If a class is a subclass of another, the object will have as its classes
  the <code>classname</code>, the superclass's <code>classname</code>, and <code>"R6"</code></p>
<p>The primary difference in behavior when <code>class=FALSE</code> is that, without
  a class attribute, it won't be possible to use S3 methods with the objects.
  So, for example, pretty printing (with <code>print.R6Class</code>) won't be used.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># A queue ---------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">Queue</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"Queue"</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">for</span> <span class="op">(</span><span class="va">item</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">self</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    add <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">private</span><span class="op">$</span><span class="va">queue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">queue</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    remove <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="fu">length</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="co"># Can use private$queue for explicit access</span></span></span>
<span class="r-in"><span>      <span class="va">head</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>      <span class="va">private</span><span class="op">$</span><span class="va">queue</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>      <span class="va">head</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    queue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    length <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="va">Queue</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="st">"foo"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add and remove items</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"something"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"another thing"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">17</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="co">#&gt; [1] 5</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-in"><span><span class="co">#&gt; [1] 6</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Private members can't be accessed directly</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="va">queue</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="co">#&gt; NULL</span></span></span>
<span class="r-in"><span><span class="co"># q$length()</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Error: attempt to apply non-function</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add() returns self, so it can be chained</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">11</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># remove() returns the value removed, so it's not chainable</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "foo"</span>
<span class="r-in"><span><span class="co">#&gt; [1] "foo"</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "something"</span>
<span class="r-in"><span><span class="co">#&gt; [1] "something"</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "another thing"</span>
<span class="r-in"><span><span class="co">#&gt; [1] "another thing"</span></span></span>
<span class="r-in"><span><span class="va">q</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17</span>
<span class="r-in"><span><span class="co">#&gt; [1] 17</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Active bindings -------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">Numbers</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"Numbers"</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x2 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="kw">else</span> <span class="va">self</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">value</span><span class="op">/</span><span class="fl">2</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    rand <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">Numbers</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-in"><span><span class="co">#&gt; [1] 100</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">x2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200</span>
<span class="r-in"><span><span class="co">#&gt; [1] 200</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 500</span>
<span class="r-in"><span><span class="co">#&gt; [1] 500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the function takes no arguments, it's not possible to use it with &lt;-:</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">rand</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.6728276</span>
<span class="r-in"><span><span class="co">#&gt; [1] 0.2648</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">$</span><span class="va">rand</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.244207</span>
<span class="r-in"><span><span class="co">#&gt; [1] 2.171</span></span></span>
<span class="r-in"><span><span class="co"># n$rand &lt;- 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Error: unused argument (quote(3))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inheritance -----------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Note that this isn't very efficient - it's just for illustrating inheritance.</span></span></span>
<span class="r-in"><span><span class="va">HistoryQueue</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"HistoryQueue"</span>,</span></span>
<span class="r-in"><span>  inherit <span class="op">=</span> <span class="va">Queue</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    show <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Next item is at index"</span>, <span class="va">private</span><span class="op">$</span><span class="va">head_idx</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">": "</span>, <span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    remove <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="fu">length</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">private</span><span class="op">$</span><span class="va">head_idx</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">private</span><span class="op">$</span><span class="va">head_idx</span> <span class="op">&lt;&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">head_idx</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>      <span class="va">private</span><span class="op">$</span><span class="va">queue</span><span class="op">[[</span><span class="va">private</span><span class="op">$</span><span class="va">head_idx</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    head_idx <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">hq</span> <span class="op">&lt;-</span> <span class="va">HistoryQueue</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="st">"foo"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hq</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Next item is at index 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: foo</span>
<span class="r-in"><span><span class="co">#&gt; Next item is at index 1</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 1: 5</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 2: 6</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 3: foo</span></span></span>
<span class="r-in"><span><span class="va">hq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="co">#&gt; [1] 5</span></span></span>
<span class="r-in"><span><span class="va">hq</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Next item is at index 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: foo</span>
<span class="r-in"><span><span class="co">#&gt; Next item is at index 2</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 1: 5</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 2: 6</span></span></span>
<span class="r-in"><span><span class="co">#&gt; 3: foo</span></span></span>
<span class="r-in"><span><span class="va">hq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-in"><span><span class="co">#&gt; [1] 6</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calling superclass methods with super$ --------------------------</span></span></span>
<span class="r-in"><span><span class="va">CountingQueue</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"CountingQueue"</span>,</span></span>
<span class="r-in"><span>  inherit <span class="op">=</span> <span class="va">Queue</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    add <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">private</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">total</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>      <span class="va">super</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    get_total <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">private</span><span class="op">$</span><span class="va">total</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    total <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cq</span> <span class="op">&lt;-</span> <span class="va">CountingQueue</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cq</span><span class="op">$</span><span class="fu">get_total</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span><span class="co">#&gt; [1] 2</span></span></span>
<span class="r-in"><span><span class="va">cq</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "x"</span>
<span class="r-in"><span><span class="co">#&gt; [1] "x"</span></span></span>
<span class="r-in"><span><span class="va">cq</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "y"</span>
<span class="r-in"><span><span class="co">#&gt; [1] "y"</span></span></span>
<span class="r-in"><span><span class="va">cq</span><span class="op">$</span><span class="fu">get_total</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span><span class="co">#&gt; [1] 3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Non-portable classes --------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># By default, R6 classes are portable, which means they can be inherited</span></span></span>
<span class="r-in"><span><span class="co"># across different packages. Portable classes require using self$ and</span></span></span>
<span class="r-in"><span><span class="co"># private$ to access members.</span></span></span>
<span class="r-in"><span><span class="co"># When used in non-portable mode, members can be accessed without self$,</span></span></span>
<span class="r-in"><span><span class="co"># and assignments can be made with &lt;&lt;-.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">NP</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"NP"</span>,</span></span>
<span class="r-in"><span>  portable <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    getx <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>    setx <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="va">x</span> <span class="op">&lt;&lt;-</span> <span class="va">value</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">np</span> <span class="op">&lt;-</span> <span class="va">NP</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">np</span><span class="op">$</span><span class="fu">setx</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">np</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-in"><span><span class="co">#&gt; [1] 10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting new values ----------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># It is possible to add new members to the class after it has been created,</span></span></span>
<span class="r-in"><span><span class="co"># by using the $set() method on the generator.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"Simple"</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    getx <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">self</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Simple</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>, <span class="st">"getx2"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">self</span><span class="op">$</span><span class="va">x</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use overwrite = TRUE to overwrite existing values</span></span></span>
<span class="r-in"><span><span class="va">Simple</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>, <span class="st">"x"</span>, <span class="fl">10</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="fu">getx2</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 20</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cloning objects -------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">Queue</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="co">#&gt; [1] 5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clone a. New object gets a's state.</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can add to each queue separately now.</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-in"><span><span class="co">#&gt; [1] 6</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 10</span>
<span class="r-in"><span><span class="co">#&gt; [1] 10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-in"><span><span class="co">#&gt; [1] 6</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="fu">remove</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 20</span>
<span class="r-in"><span><span class="co">#&gt; [1] 20</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Deep clones -----------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"Simple"</span>,</span></span>
<span class="r-in"><span> public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   x <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>   initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">val</span><span class="op">)</span> <span class="va">self</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">val</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Cloner</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"Cloner"</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    s <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">self</span><span class="op">$</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">Cloner</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">c</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Modify a</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">s</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># b is a shallow clone. b$s is the same as a$s because they are R6 objects.</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">s</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span><span class="co">#&gt; [1] 2</span></span></span>
<span class="r-in"><span><span class="co"># But a$y and b$y are different, because y is just a value.</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">y</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># c is a deep clone, so c$s is not the same as a$s.</span></span></span>
<span class="r-in"><span><span class="va">c</span><span class="op">$</span><span class="va">s</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span><span class="va">c</span><span class="op">$</span><span class="va">y</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Deep clones with custom deep_clone method -----------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">CustomCloner</span> <span class="op">&lt;-</span> <span class="kw">R6Class</span><span class="op">(</span><span class="st">"CustomCloner"</span>,</span></span>
<span class="r-in"><span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    e <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    s1 <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    s2 <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    s3 <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">self</span><span class="op">$</span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">self</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>      <span class="va">self</span><span class="op">$</span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">self</span><span class="op">$</span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">self</span><span class="op">$</span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="co"># When x$clone(deep=TRUE) is called, the deep_clone gets invoked once for</span></span></span>
<span class="r-in"><span>    <span class="co"># each field, with the name and value.</span></span></span>
<span class="r-in"><span>    deep_clone <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"e"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="co"># e1 is an environment, so use this quick way of copying</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list.environment</a></span><span class="op">(</span><span class="va">value</span>, all.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="co"># s1 and s2 are R6 objects which we can clone</span></span></span>
<span class="r-in"><span>        <span class="va">value</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="co"># For everything else, just return it. This results in a shallow</span></span></span>
<span class="r-in"><span>        <span class="co"># copy of s3.</span></span></span>
<span class="r-in"><span>        <span class="va">value</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">CustomCloner</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Change some values in a's fields</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">s1</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">s2</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">$</span><span class="va">s3</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># b has copies of e, s1, and s2, but shares the same s3</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">e</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">s1</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">s2</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="co">#&gt; [1] 1</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">s3</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="co">#&gt; [1] 5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Debugging -------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># This will enable debugging the getx() method for objects of the 'Simple'</span></span></span>
<span class="r-in"><span><span class="co"># class that are instantiated in the future.</span></span></span>
<span class="r-in"><span><span class="va">Simple</span><span class="op">$</span><span class="fu">debug</span><span class="op">(</span><span class="st">"getx"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Disable debugging for future instances:</span></span></span>
<span class="r-in"><span><span class="va">Simple</span><span class="op">$</span><span class="fu">undebug</span><span class="op">(</span><span class="st">"getx"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To enable and disable debugging for a method in a single instance of an</span></span></span>
<span class="r-in"><span><span class="co"># R6 object (this will not affect other objects):</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">Simple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/debug.html" class="external-link">debug</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">getx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="fu">getx</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/debug.html" class="external-link">undebug</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">getx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

